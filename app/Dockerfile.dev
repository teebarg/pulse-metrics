# FROM node:22-alpine

# RUN corepack enable && corepack prepare pnpm@latest --activate

# WORKDIR /app

# COPY app/package.json app/pnpm-lock.yaml ./

# RUN pnpm install --frozen-lockfile

# COPY app ./

# EXPOSE 5173 8787

# CMD ["pnpm", "dev"]

FROM node:22-alpine

# Install pnpm globally
RUN corepack enable && corepack prepare pnpm@latest --activate

WORKDIR /app

# Copy only lockfile + package manifest first (for caching)
COPY app/pnpm-lock.yaml app/package.json ./

# Pre-fetch dependencies (creates virtual store)
RUN pnpm fetch

# Now copy the entire app
COPY app ./

# Install deps using offline store (super fast)
RUN pnpm install --offline

EXPOSE 5173

CMD ["pnpm", "dev"]

